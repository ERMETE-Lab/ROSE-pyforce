<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Online Phase: POD with Interpolation &mdash; pyforce 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=01f34227"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "tags": "ams", "useLabelIds": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Steady State MultiGroup Diffusion for ANL11-A2 benchmark" href="../02_ANL11-A2_stationary.html" />
    <link rel="prev" title="Offline Phase" href="02_offline_POD.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html">
            
              <img src="../../_static/pyforce_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../intro.html">Welcome to <em>pyforce</em>’s documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../theory.html">Theory and package structure</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../01_DFG2_benchmark.html">Unsteady Laminar Navier-Stokes - DFG2 benchmark</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="01_generateFlowData.html">Generation of the snapshots</a></li>
<li class="toctree-l3"><a class="reference internal" href="02_offline_POD.html">Offline Phase</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Online Phase: POD-I</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Importing-Snapshots-and-offline-results">Importing Snapshots and offline results</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Online-Phase">Online Phase</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../02_ANL11-A2_stationary.html">MultiGroup Neutron Diffusion - ANL11-A2 benchmark</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03_buoyant_cavity.html">Steady Buoyant Navier-Stokes - Differentially Heated Cavity</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/pyforce.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bibliography.html">Bibliography</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pyforce</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../tutorials.html">Tutorials</a></li>
          <li class="breadcrumb-item"><a href="../01_DFG2_benchmark.html">Unsteady Laminar Navier Stokes - DFG2 benchmark</a></li>
      <li class="breadcrumb-item active">Online Phase: POD with Interpolation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/Tutorials/01_LaminarNS/03_online_POD-I.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Online-Phase:-POD-with-Interpolation">
<h1>Online Phase: POD with Interpolation<a class="headerlink" href="#Online-Phase:-POD-with-Interpolation" title="Link to this heading"></a></h1>
<p><strong>Aim of the tutorial:</strong> this notebook shows how to perform the online phase of the POD with Interpolation (PODI) algorithm, i.e. how to use this method to reconstruct a field for an unseen input parameter.</p>
<p>In particular, the basis functions, generated offline by the POD, provide the spatial behaviour, whereas the parametric dependence is embedded in the reduced coefficients learnt through suitable maps (i.e., Linear or RBF Interpolation or Supervised Learning method such as the Gaussian Process Regression).</p>
<hr class="docutils" />
<p><em>To execute this notebook</em> it is necessary to have the snapshots stored in <code class="docutils literal notranslate"><span class="pre">Snapshots</span></code> folder, placed in this directory (otherwise modify <code class="docutils literal notranslate"><span class="pre">path_FOM</span></code> variable) and to have the directory <code class="docutils literal notranslate"><span class="pre">Offline_results</span></code> containing the POD modes and the maps for the reduced coefficients.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">clear_output</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pickle</span>

<span class="kn">from</span> <span class="nn">dolfinx.fem</span> <span class="kn">import</span> <span class="n">FunctionSpace</span>
<span class="kn">from</span> <span class="nn">pyforce.online.pod_interpolation</span> <span class="kn">import</span> <span class="n">PODI</span>
<span class="kn">from</span> <span class="nn">pyforce.online.pod_projection</span> <span class="kn">import</span> <span class="n">PODproject</span>
<span class="kn">import</span> <span class="nn">ufl</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>

<span class="kn">from</span> <span class="nn">pyforce.tools.functions_list</span> <span class="kn">import</span> <span class="n">FunctionsList</span><span class="p">,</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">pyforce.tools.write_read</span> <span class="kn">import</span> <span class="n">ImportH5</span>


<span class="n">path_off</span> <span class="o">=</span><span class="s1">&#39;./Offline_results/&#39;</span>
</pre></div>
</div>
</div>
<p>The geometry can be either generated directly in this notebook or loaded from a file.</p>
<p><strong>Disclaimer</strong>: we have noticed that the degrees of freedom (dofs) of the mesh can vary according to the adopted operating system: for instance, if run on MacOS the dofs are 2356, whereas on Linux machines they are 2385. This is due to the fact that the mesh is generated through the <code class="docutils literal notranslate"><span class="pre">gmsh</span></code> library, which can produce different results on different platforms.</p>
<p><em>If an error occurs, please check the number of dofs and adjust the code accordingly: if the snapshots have been download from</em> <a class="reference external" href="https://zenodo.org/records/11483677">Zenodo</a> <em>it is suggested to load the ``msh`` file; otherwise, if the snapshots hase been generated locally, the ``use_msh`` option must be set to ``False``.</em></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ns</span> <span class="kn">import</span> <span class="n">create_dfg2_mesh</span>

<span class="c1"># Snapshots downloaded</span>
<span class="c1"># domain = create_dfg2_mesh(mesh_factor=0.5, use_msh=True)[0]</span>

<span class="c1"># Snapshots generated locally</span>
<span class="n">domain</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">ft</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">create_dfg2_mesh</span><span class="p">(</span><span class="n">mesh_factor</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">use_msh</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_mesh</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">clear_output</span><span class="p">()</span>
</pre></div>
</div>
</div>
<section id="Importing-Snapshots-and-offline-results">
<h2>Importing Snapshots and offline results<a class="headerlink" href="#Importing-Snapshots-and-offline-results" title="Link to this heading"></a></h2>
<p>The snapshots are loaded and stored into suitable data structures.</p>
<p>Defining the functional space</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fun_spaces</span> <span class="o">=</span> <span class="p">[</span><span class="n">FunctionSpace</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;Lagrange&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
              <span class="n">FunctionSpace</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">ufl</span><span class="o">.</span><span class="n">VectorElement</span><span class="p">(</span><span class="s2">&quot;Lagrange&quot;</span><span class="p">,</span> <span class="n">domain</span><span class="o">.</span><span class="n">ufl_cell</span><span class="p">(),</span> <span class="mi">1</span><span class="p">))]</span>
</pre></div>
</div>
</div>
<p>Defining the variables to load</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">var_names</span> <span class="o">=</span> <span class="p">[</span>
             <span class="s1">&#39;p&#39;</span><span class="p">,</span>
             <span class="s1">&#39;u&#39;</span>
             <span class="p">]</span>

<span class="n">tex_var_names</span> <span class="o">=</span> <span class="p">[</span>
                 <span class="sa">r</span><span class="s1">&#39;p&#39;</span><span class="p">,</span>
                 <span class="sa">r</span><span class="s1">&#39;\mathbf</span><span class="si">{u}</span><span class="s1">&#39;</span>
                 <span class="p">]</span>
</pre></div>
</div>
</div>
<p>Let us load the snapshots from the approapriate folder and let us extract the test set using random split (be sure to use the same <code class="docutils literal notranslate"><span class="pre">random_state</span></code> of the offline phase, this condition is satisfied if <code class="docutils literal notranslate"><span class="pre">random_state</span></code> is not passed to <code class="docutils literal notranslate"><span class="pre">train_test_split</span></code>).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">path_FOM</span> <span class="o">=</span> <span class="s1">&#39;./Snapshots/&#39;</span>

<span class="n">test_snaps</span>  <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="n">test_params</span>  <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

<span class="k">for</span> <span class="n">field_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">var_names</span><span class="p">)):</span>

    <span class="n">tmp_FOM_list</span><span class="p">,</span> <span class="n">tmp_param</span> <span class="o">=</span> <span class="n">ImportH5</span><span class="p">(</span><span class="n">fun_spaces</span><span class="p">[</span><span class="n">field_i</span><span class="p">],</span> <span class="n">path_FOM</span><span class="o">+</span><span class="s1">&#39;snaps_&#39;</span><span class="o">+</span><span class="n">var_names</span><span class="p">[</span><span class="n">field_i</span><span class="p">],</span> <span class="n">var_names</span><span class="p">[</span><span class="n">field_i</span><span class="p">])</span>

    <span class="n">res</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">tmp_param</span><span class="p">,</span> <span class="n">tmp_FOM_list</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>

    <span class="n">test_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">test_snaps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

    <span class="k">del</span> <span class="n">tmp_FOM_list</span><span class="p">,</span> <span class="n">tmp_param</span>
</pre></div>
</div>
</div>
<p>The POD modes are loaded using <code class="docutils literal notranslate"><span class="pre">ImportH5</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pod_modes</span> <span class="o">=</span> <span class="p">[</span><span class="n">ImportH5</span><span class="p">(</span><span class="n">fun_spaces</span><span class="p">[</span><span class="n">field_i</span><span class="p">],</span>
                      <span class="n">path_off</span><span class="o">+</span><span class="s1">&#39;BasisFunctions/basisPOD_&#39;</span> <span class="o">+</span> <span class="n">var_names</span><span class="p">[</span><span class="n">field_i</span><span class="p">],</span>
                      <span class="s1">&#39;POD_&#39;</span> <span class="o">+</span><span class="n">var_names</span><span class="p">[</span><span class="n">field_i</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">field_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">var_names</span><span class="p">))]</span>
</pre></div>
</div>
</div>
<p>Then, let us import the maps <span class="math notranslate nohighlight">\(t\longrightarrow \alpha_m(t)\)</span></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coeff_maps</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">path_off</span><span class="o">+</span><span class="s1">&#39;pod_coeff.maps&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</section>
<section id="Online-Phase">
<h2>Online Phase<a class="headerlink" href="#Online-Phase" title="Link to this heading"></a></h2>
<p>The test set related to unseen parameters are reconstruction using the Proper Orthogonal Decomposition with Intepolation, compared with the projection case.</p>
<section id="Test-Error">
<h3>Test Error<a class="headerlink" href="#Test-Error" title="Link to this heading"></a></h3>
<p>Let us first define the structures for storing the errors and the computational time: a dictionary is used to store the errors for each map tested.</p>
<p>As maximum number of modes, we use the number of modes available <span class="math notranslate nohighlight">\(N_{max} = 30\)</span>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_results</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

<span class="n">Nmax</span> <span class="o">=</span> <span class="mi">30</span>

<span class="k">assert</span> <span class="n">Nmax</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pod_modes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="k">assert</span> <span class="n">Nmax</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pod_modes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<p>Let us reconstruct the field using the POD projection, the coefficients are obtained by means of the following projection (scalar product in <span class="math notranslate nohighlight">\(L^2\)</span>) for an unseen parameter <span class="math notranslate nohighlight">\(\boldsymbol{\mu}^\star\)</span>: <span class="math">\begin{equation*}
\alpha_m(\boldsymbol{\mu}^\star) = \int_{\Omega} u(\mathbf{x}; \boldsymbol{\mu}^\star)\cdot \psi_m\, d\Omega
\end{equation*}</span></p>
<p>This is the standard POD projection, which is used as a reference for the interpolation methods, acting as best-case scenario: it cannot be adopted for real problems because it is assumed to know the actual FOM solution. This produdure is implemented in the <code class="docutils literal notranslate"><span class="pre">PODproject</span></code> class: the initialisation requires the POD modes and the name of the variable to be reconstructed.</p>
<p>Then, the method <code class="docutils literal notranslate"><span class="pre">synt_test_error</span></code> is used to compute the error for the unseen parameters: this requires the test snapshots for comparison and the number of modes to be used.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pod_proj_online</span> <span class="o">=</span> <span class="p">[</span><span class="n">PODproject</span><span class="p">(</span><span class="n">pod_modes</span><span class="p">[</span><span class="n">field_i</span><span class="p">],</span>
                              <span class="n">name</span><span class="o">=</span><span class="n">var_names</span><span class="p">[</span><span class="n">field_i</span><span class="p">])</span> <span class="k">for</span> <span class="n">field_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">var_names</span><span class="p">))]</span>

<span class="n">test_results</span><span class="p">[</span><span class="s1">&#39;POD-Project&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="n">pod_proj_online</span><span class="p">[</span><span class="n">field_i</span><span class="p">]</span><span class="o">.</span><span class="n">synt_test_error</span><span class="p">(</span><span class="n">test_snaps</span><span class="p">[</span><span class="n">field_i</span><span class="p">],</span> <span class="n">Nmax</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                                <span class="k">for</span> <span class="n">field_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">var_names</span><span class="p">))]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Computing POD test error (projection) - p: 160.000 / 160.00 - 0.035 s/it
Computing POD test error (projection) - u: 160.000 / 160.00 - 0.046 s/it
</pre></div></div>
</div>
<p>The output of the previous cell is a list for each field reconstructed: there 2 elements in this case, since the fields to reconstruct are the pressure and the velocity. The method <code class="docutils literal notranslate"><span class="pre">synt_test_error</span></code> produces a <code class="docutils literal notranslate"><span class="pre">namedtuple</span></code> with 3 elements:</p>
<ul class="simple">
<li><p>mean_abs_err</p></li>
<li><p>mean_rel_err</p></li>
<li><p>computational_time</p></li>
</ul>
<p>The first two are list of floats, containing the mean absolute and relative errors for each field, respectively, defined as follows <span class="math">\begin{equation*}
\begin{split}
E_N[u] &= \left\langle \left\| u(\cdot;\,\boldsymbol{\mu}) - \mathcal{P}_N[u](\cdot;\,\boldsymbol{\mu})\right\|_{L^2(\Omega)}\right\rangle_{\boldsymbol{\mu}\in\Xi^{test}}\\
\varepsilon_N[u] &= \left\langle\frac{\left\| u(\cdot;\,\boldsymbol{\mu}) - \mathcal{P}_N[u](\cdot;\,\boldsymbol{\mu})\right\|_{L^2(\Omega)}}{\left\| u(\cdot;\,\boldsymbol{\mu}) \right\|_{L^2(\Omega)}}\right\rangle_{\boldsymbol{\mu}\in\Xi^{test}}
\end{split}
\end{equation*}</span> given <span class="math notranslate nohighlight">\(\mathcal{P}_N\)</span> the reconstruction operator with <span class="math notranslate nohighlight">\(N\)</span> basis functions.</p>
<p>The last element is a dictionary with computational time required to perform the reconstruction.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">test_results</span><span class="p">[</span><span class="s1">&#39;POD-Project&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_fields</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&#39;mean_abs_err&#39;, &#39;mean_rel_err&#39;, &#39;computational_time&#39;)
</pre></div></div>
</div>
<p>Then, let us use the POD with Interpolation in which the coefficients <span class="math notranslate nohighlight">\(\alpha_m(t)\)</span> are estimated through a suitable map (e.g., interpolation). This produdure is implemented in the <code class="docutils literal notranslate"><span class="pre">PODI</span></code> class: the initialisation requires the POD modes, the maps and the name of the variable to be reconstructed.</p>
<p>Then, the method <code class="docutils literal notranslate"><span class="pre">synt_test_error</span></code> is used to compute the error for the unseen parameters: this requires the test snapshots for comparison and the number of modes to be used.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pod_i_online</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---------------------------------------------------------------------------&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">key_i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">coeff_maps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;PODI-&#39;</span><span class="o">+</span><span class="n">key</span><span class="p">)</span>

    <span class="n">pod_i_online</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">PODI</span><span class="p">(</span><span class="n">pod_modes</span><span class="p">[</span><span class="n">field</span><span class="p">],</span> <span class="n">coeff_maps</span><span class="p">[</span><span class="n">field</span><span class="p">][</span><span class="n">key</span><span class="p">],</span>
                              <span class="n">name</span><span class="o">=</span><span class="n">var_names</span><span class="p">[</span><span class="n">field</span><span class="p">])</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">var_names</span><span class="p">))]</span>

    <span class="n">test_results</span><span class="p">[</span><span class="s1">&#39;PODI-&#39;</span><span class="o">+</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pod_i_online</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">field_i</span><span class="p">]</span><span class="o">.</span><span class="n">synt_test_error</span><span class="p">(</span><span class="n">test_snaps</span><span class="p">[</span><span class="n">field_i</span><span class="p">],</span> <span class="n">test_params</span><span class="p">[</span><span class="n">field_i</span><span class="p">],</span> <span class="n">Nmax</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                                <span class="k">for</span> <span class="n">field_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">var_names</span><span class="p">))]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---------------------------------------------------------------------------&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
---------------------------------------------------------------------------
POD-LinInt
Computing POD test error (interpolation) - p: 160.000 / 160.00 - 0.025 s/it
Computing POD test error (interpolation) - u: 160.000 / 160.00 - 0.031 s/it
---------------------------------------------------------------------------
POD-RBF
Computing POD test error (interpolation) - p: 160.000 / 160.00 - 0.023 s/it
Computing POD test error (interpolation) - u: 160.000 / 160.00 - 0.026 s/it
---------------------------------------------------------------------------
</pre></div></div>
</div>
<p>Let us plot the error as a function of the basis rank.</p>
<p><strong>Note on the results structure</strong>: <code class="docutils literal notranslate"><span class="pre">test_results[key][field_i]</span></code> is a list of <code class="docutils literal notranslate"><span class="pre">namedtuple</span></code> with 3 elements, as described above. <code class="docutils literal notranslate"><span class="pre">key</span></code> is the name of algorithm used (i.e., <em>POD-project</em>, <em>‘PODI-LinInt’</em> and <em>‘PODI-RBF</em>), <code class="docutils literal notranslate"><span class="pre">field_i</span></code> is the index of the field (i.e., <em>‘pressure’</em> and <em>‘velocity’</em>). In this cell, we plot the first two elements of the <code class="docutils literal notranslate"><span class="pre">namedtuple</span></code> for each field and each algorithm.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_errors</span><span class="p">(</span><span class="n">var_names</span><span class="p">,</span> <span class="n">Nmax</span><span class="p">,</span> <span class="n">test_results</span><span class="p">):</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="mi">4</span><span class="p">))</span>

    <span class="n">N_plot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Nmax</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">fontsize</span>  <span class="o">=</span> <span class="mi">20</span>
    <span class="n">labelsize</span> <span class="o">=</span> <span class="mi">15</span>

    <span class="n">markers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">]</span>
    <span class="n">lines_style</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;-.&#39;</span><span class="p">]</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">([</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">field_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">var_names</span><span class="p">)):</span>

        <span class="n">ax2</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">field_i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">test_results</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
            <span class="n">axs</span><span class="p">[</span><span class="n">field_i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">N_plot</span><span class="p">,</span> <span class="n">test_results</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">field_i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">markers</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="n">lines_style</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">N_plot</span><span class="p">,</span> <span class="n">test_results</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">field_i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">markers</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="n">lines_style</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>

        <span class="n">axs</span><span class="p">[</span><span class="n">field_i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Absolute Error - $&#39;</span><span class="o">+</span><span class="n">tex_var_names</span><span class="p">[</span><span class="n">field_i</span><span class="p">]</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Relative Error - $&#39;</span><span class="o">+</span><span class="n">tex_var_names</span><span class="p">[</span><span class="n">field_i</span><span class="p">]</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

        <span class="n">axs</span><span class="p">[</span><span class="n">field_i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">field_i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">field_i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">field_i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">field_i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">labelsize</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">():</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">labelsize</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;POD modes used $N$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;POD modes used $N$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="n">Line</span><span class="p">,</span> <span class="n">Label</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">Line</span><span class="p">,</span> <span class="n">Label</span><span class="p">,</span> <span class="n">framealpha</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">labelsize</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.925</span><span class="p">),</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span> <span class="o">=</span> <span class="mf">0.025</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.025</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plot_errors</span><span class="p">(</span><span class="n">var_names</span><span class="p">,</span> <span class="n">Nmax</span><span class="p">,</span> <span class="n">test_results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/Tutorials_01_LaminarNS_03_online_POD-I_25_0.png" src="../../_images/Tutorials_01_LaminarNS_03_online_POD-I_25_0.png" />
</div>
</div>
<p>Let us also plot the computational costs.</p>
<p><strong>Note on the results structure</strong>: <code class="docutils literal notranslate"><span class="pre">test_results[key][field_i][2]</span></code> contains the computational times, this is a dictornary with different entries. We are interested in showing the time required to estimate a coefficient, i.e. <code class="docutils literal notranslate"><span class="pre">test_results[key][field_i][2]['CoeffEstimation]</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_computational_times</span><span class="p">(</span><span class="n">var_names</span><span class="p">,</span> <span class="n">test_results</span><span class="p">):</span>

    <span class="c1"># Initialize subplots</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

    <span class="c1"># Iterate over field_i values</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Reds</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">var_names</span><span class="p">)))</span>  <span class="c1"># Choose a colormap</span>
    <span class="k">for</span> <span class="n">field_i</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">var_names</span><span class="p">)),</span> <span class="n">colors</span><span class="p">):</span>
        <span class="n">means</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">stds</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Calculate mean and std for each key</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">test_results</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">test_results</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">field_i</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;CoeffEstimation&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
            <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">test_results</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">field_i</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;CoeffEstimation&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
            <span class="n">means</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean</span><span class="p">)</span>
            <span class="n">stds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">std</span><span class="p">)</span>

        <span class="c1"># Plot the bar chart with error bars for standard deviation</span>
        <span class="n">bar_width</span> <span class="o">=</span> <span class="mf">0.2</span>  <span class="c1"># Adjust as needed</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">test_results</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>
        <span class="n">bars</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="p">(</span><span class="n">field_i</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">var_names</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="n">bar_width</span><span class="p">,</span> <span class="n">means</span><span class="p">,</span> <span class="n">bar_width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$&#39;</span><span class="o">+</span><span class="n">tex_var_names</span><span class="p">[</span><span class="n">field_i</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;$&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">stds</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;CPU Time (s)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Computational Time to estimate a coefficient&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">test_results</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">framealpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plot_computational_times</span><span class="p">(</span><span class="n">var_names</span><span class="p">,</span> <span class="n">test_results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/Tutorials_01_LaminarNS_03_online_POD-I_27_0.png" src="../../_images/Tutorials_01_LaminarNS_03_online_POD-I_27_0.png" />
</div>
</div>
</section>
<section id="Post-Process">
<h3>Post Process<a class="headerlink" href="#Post-Process" title="Link to this heading"></a></h3>
<p>In this last section, the test snapshots and the reconstruction using POD-I are plotted using <code class="docutils literal notranslate"><span class="pre">pyvista</span></code>.</p>
<p>The value of <span class="math notranslate nohighlight">\(N_{max}\)</span> is set to 15, but the user is invited to change it and see the effect of adding/removing the modes. The following cell is used to generate the data structure for the post-processing: a list of dictionaries is created for each field. Each dictionary has as keys related to the different algorithm tested and its elements are a <code class="docutils literal notranslate"><span class="pre">FunctionsList</span></code> containing the reconstructed field.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Nmax</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">test_results</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<span class="n">reconstructions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

<span class="k">for</span> <span class="n">field_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">var_names</span><span class="p">)):</span>
    <span class="n">reconstructions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">())</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
        <span class="n">reconstructions</span><span class="p">[</span><span class="n">field_i</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">FunctionsList</span><span class="p">(</span><span class="n">fun_spaces</span><span class="p">[</span><span class="n">field_i</span><span class="p">])</span>
</pre></div>
</div>
</div>
<p>The POD projection is performed using the <code class="docutils literal notranslate"><span class="pre">PODproject</span></code> class, adopting the <code class="docutils literal notranslate"><span class="pre">reconstruct</span></code> method for all the snapshot of the test set. The first output of this method is the reconstructed field.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">field_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">var_names</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">mu</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_snaps</span><span class="p">[</span><span class="n">field_i</span><span class="p">])):</span>
        <span class="n">reconstructions</span><span class="p">[</span><span class="n">field_i</span><span class="p">][</span><span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">pod_proj_online</span><span class="p">[</span><span class="n">field_i</span><span class="p">]</span><span class="o">.</span><span class="n">reconstruct</span><span class="p">(</span><span class="n">test_snaps</span><span class="p">[</span><span class="n">field_i</span><span class="p">](</span><span class="n">mu</span><span class="p">),</span> <span class="n">Nmax</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">)</span>
</pre></div>
</div>
</div>
<p>The POD with Interpolation is performed using the <code class="docutils literal notranslate"><span class="pre">PODI</span></code> class, adopting the <code class="docutils literal notranslate"><span class="pre">reconstruct</span></code> method for all the parameters of the test set. The first output of this method is the reconstructed field.</p>
<p>The inputs of this method are the test snapshots (used to compute the associated residual field of the reconstruction, <span class="math notranslate nohighlight">\(r = u - \mathcal{P}_N[u]\)</span>), the maps for the interpolation and the number of modes to be used.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">field_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">var_names</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">mu</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_snaps</span><span class="p">[</span><span class="n">field_i</span><span class="p">])):</span>
        <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)):</span>
            <span class="n">reconstructions</span><span class="p">[</span><span class="n">field_i</span><span class="p">][</span><span class="n">keys</span><span class="p">[</span><span class="n">jj</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">pod_i_online</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="mi">5</span><span class="p">:]][</span><span class="n">field_i</span><span class="p">]</span><span class="o">.</span><span class="n">reconstruct</span><span class="p">(</span><span class="n">test_snaps</span><span class="p">[</span><span class="n">field_i</span><span class="p">](</span><span class="n">mu</span><span class="p">),</span> <span class="n">test_params</span><span class="p">[</span><span class="n">field_i</span><span class="p">][</span><span class="n">mu</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">Nmax</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="p">)</span>
</pre></div>
</div>
</div>
<p>Let us assert the drag, lift and pressure difference with respect to FOM and benchmark data.</p>
<p>We need to compute the drag and lift coefficients and the pressure difference exploiting the <code class="docutils literal notranslate"><span class="pre">DragLift</span></code> class from <code class="docutils literal notranslate"><span class="pre">ns.py</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ns</span> <span class="kn">import</span> <span class="n">DragLift</span>
<span class="kn">from</span> <span class="nn">dolfinx.fem</span> <span class="kn">import</span> <span class="n">Function</span><span class="p">,</span> <span class="n">Expression</span>

<span class="n">T</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">5.00e-4</span>                <span class="c1"># Time step size</span>

<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;nu&#39;</span><span class="p">:</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="s1">&#39;rhoLU2&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">}</span>

<span class="c1"># Definition of the markers for the boundaries</span>
<span class="n">bound_markers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">bound_markers</span><span class="p">[</span><span class="s1">&#39;inlet&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="mi">1</span>
<span class="n">bound_markers</span><span class="p">[</span><span class="s1">&#39;walls&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="mi">2</span>
<span class="n">bound_markers</span><span class="p">[</span><span class="s1">&#39;outlet&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="mi">3</span>
<span class="n">bound_markers</span><span class="p">[</span><span class="s1">&#39;obstacle&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="mi">4</span>

<span class="n">QoI_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">compute_d_l</span><span class="p">(</span><span class="n">p_snaps</span><span class="p">:</span> <span class="n">FunctionsList</span><span class="p">,</span> <span class="n">u_snaps</span><span class="p">:</span> <span class="n">FunctionsList</span><span class="p">,</span>
                <span class="n">domain</span><span class="p">,</span> <span class="n">ft</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">bound_markers</span><span class="p">):</span>

    <span class="n">V2</span> <span class="o">=</span> <span class="n">FunctionSpace</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">ufl</span><span class="o">.</span><span class="n">VectorElement</span><span class="p">(</span><span class="s2">&quot;Lagrange&quot;</span><span class="p">,</span> <span class="n">domain</span><span class="o">.</span><span class="n">ufl_cell</span><span class="p">(),</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">u2</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="n">V2</span><span class="p">)</span>
    <span class="n">get_drag_lift</span> <span class="o">=</span> <span class="n">DragLift</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">ft</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">bound_markers</span><span class="p">[</span><span class="s1">&#39;obstacle&#39;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">mu</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">test_params</span><span class="p">[</span><span class="n">field_i</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()):</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span>
        <span class="n">u2</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">Expression</span><span class="p">(</span><span class="n">u_snaps</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mu</span><span class="p">),</span> <span class="n">V2</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">interpolation_points</span><span class="p">()))</span>
        <span class="n">get_drag_lift</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">test_params</span><span class="p">[</span><span class="n">field_i</span><span class="p">][</span><span class="n">mu</span><span class="p">],</span> <span class="n">dt</span><span class="p">,</span> <span class="n">u2</span><span class="p">,</span> <span class="n">p_snaps</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mu</span><span class="p">))</span>

    <span class="n">_data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">_data</span><span class="p">[</span><span class="s1">&#39;t_u&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_drag_lift</span><span class="o">.</span><span class="n">t_u</span>
    <span class="n">_data</span><span class="p">[</span><span class="s1">&#39;t_p&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_drag_lift</span><span class="o">.</span><span class="n">t_p</span>
    <span class="n">_data</span><span class="p">[</span><span class="s1">&#39;C_D&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_drag_lift</span><span class="o">.</span><span class="n">C_D</span>
    <span class="n">_data</span><span class="p">[</span><span class="s1">&#39;C_L&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_drag_lift</span><span class="o">.</span><span class="n">C_L</span>
    <span class="n">_data</span><span class="p">[</span><span class="s1">&#39;dP&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">get_drag_lift</span><span class="o">.</span><span class="n">p_diff</span>

    <span class="k">return</span> <span class="n">_data</span>

<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">reconstructions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
    <span class="n">QoI_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">compute_d_l</span><span class="p">(</span><span class="n">reconstructions</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">key</span><span class="p">],</span> <span class="n">reconstructions</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">],</span>
                                <span class="n">domain</span><span class="p">,</span> <span class="n">ft</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">bound_markers</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>Let us compare the ROM results with the benchmark data.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">turek</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s2">&quot;./../BenchmarkData/LaminarNS_DFG2/bdforces_lv4.txt&quot;</span><span class="p">)</span>
<span class="n">turek_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s2">&quot;./../BenchmarkData/LaminarNS_DFG2/pointvalues_lv4.txt&quot;</span><span class="p">)</span>

<span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="nb">list</span><span class="p">(</span><span class="n">reconstructions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">turbo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
<span class="n">markers_styles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">]</span>
<span class="n">line_styles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

<span class="c1"># Drag Coefficient</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">turek</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">turek</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span><span class="mi">3</span><span class="p">],</span> <span class="s2">&quot;-^&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">markevery</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;FEATFLOW&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)):</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">QoI_data</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="s1">&#39;t_u&#39;</span><span class="p">],</span> <span class="n">QoI_data</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="s1">&#39;C_D&#39;</span><span class="p">],</span> <span class="n">line_styles</span><span class="p">[</span><span class="n">kk</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">kk</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">keys</span><span class="p">[</span><span class="n">kk</span><span class="p">])</span>

<span class="c1"># Lift Coefficient</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">turek</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">turek</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span><span class="mi">4</span><span class="p">],</span> <span class="s2">&quot;-^&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">markevery</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;FEATFLOW&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)):</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">QoI_data</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="s1">&#39;t_u&#39;</span><span class="p">],</span> <span class="n">QoI_data</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="s1">&#39;C_L&#39;</span><span class="p">],</span> <span class="n">markers_styles</span><span class="p">[</span><span class="n">kk</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">kk</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">keys</span><span class="p">[</span><span class="n">kk</span><span class="p">])</span>

<span class="c1"># Pressure Difference</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">turek</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">turek_p</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span><span class="mi">6</span><span class="p">]</span><span class="o">-</span><span class="n">turek_p</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;-^&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">markevery</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;FEATFLOW&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)):</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">QoI_data</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="s1">&#39;t_p&#39;</span><span class="p">],</span> <span class="n">QoI_data</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="s1">&#39;dP&#39;</span><span class="p">],</span> <span class="n">line_styles</span><span class="p">[</span><span class="n">kk</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">kk</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">keys</span><span class="p">[</span><span class="n">kk</span><span class="p">])</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Drag coefficient $c_D$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Lift coefficient $c_L$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Pressure Difference $\delta p$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Time $t$ (s)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">T</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axs</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/Tutorials_01_LaminarNS_03_online_POD-I_37_0.png" src="../../_images/Tutorials_01_LaminarNS_03_online_POD-I_37_0.png" />
</div>
</div>
<p>In the end, the contour plots of the different reconstruction algorithms can be generated using a function implemented in <code class="docutils literal notranslate"><span class="pre">contour_plotting.py</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">contour_plotting</span> <span class="kn">import</span> <span class="n">plot_FOM_vs_ROM</span>

<span class="n">sorted_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">test_params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>

<span class="n">cmaps</span> <span class="o">=</span> <span class="p">[</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">,</span> <span class="n">cm</span><span class="o">.</span><span class="n">RdYlBu_r</span><span class="p">]</span>
<span class="n">cmaps_res</span> <span class="o">=</span> <span class="p">[</span><span class="n">cm</span><span class="o">.</span><span class="n">hot</span><span class="p">,</span> <span class="n">cm</span><span class="o">.</span><span class="n">bwr</span><span class="p">]</span>

<span class="n">tt_plot</span> <span class="o">=</span> <span class="n">sorted_idx</span><span class="p">[</span><span class="mi">140</span><span class="p">]</span>

<span class="k">for</span> <span class="n">field_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">var_names</span><span class="p">)):</span>

    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Time = </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">test_params</span><span class="p">[</span><span class="n">field_i</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="n">tt_plot</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39; s&#39;</span>

    <span class="n">plot_FOM_vs_ROM</span><span class="p">(</span> <span class="n">test_snaps</span><span class="p">[</span><span class="n">field_i</span><span class="p">],</span> <span class="n">reconstructions</span><span class="p">[</span><span class="n">field_i</span><span class="p">],</span>
                    <span class="n">tt_plot</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">tex_var_names</span><span class="p">[</span><span class="n">field_i</span><span class="p">],</span>
                    <span class="n">colormap</span><span class="o">=</span><span class="n">cmaps</span><span class="p">[</span><span class="n">field_i</span><span class="p">],</span> <span class="n">colormap_res</span> <span class="o">=</span> <span class="n">cmaps_res</span><span class="p">[</span><span class="n">field_i</span><span class="p">],</span>
                    <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mag_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">factor</span> <span class="o">=</span> <span class="mf">0.06</span><span class="p">,</span> <span class="n">tolerance</span> <span class="o">=</span> <span class="mf">0.01</span>
                    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/Tutorials_01_LaminarNS_03_online_POD-I_39_0.png" src="../../_images/Tutorials_01_LaminarNS_03_online_POD-I_39_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/Tutorials_01_LaminarNS_03_online_POD-I_39_1.png" src="../../_images/Tutorials_01_LaminarNS_03_online_POD-I_39_1.png" />
</div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="02_offline_POD.html" class="btn btn-neutral float-left" title="Offline Phase" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../02_ANL11-A2_stationary.html" class="btn btn-neutral float-right" title="Steady State MultiGroup Diffusion for ANL11-A2 benchmark" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Stefano Riva, Carolina Introini, Antonio Cammi.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>